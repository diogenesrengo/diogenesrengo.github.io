<!DOCTYPE html>
<html>
  <head>
    <style>
      canvas {
        display: block;
        background-color: black;
      }
    </style>
  </head>
  <body>
    <canvas id="fireworksCanvas" width="800" height="600"></canvas>

    <script>
      /* credits to https://github.com/The-Best-Codes/the-best-codes.github.io */
      const canvas = document.getElementById("fireworksCanvas");
      const c = canvas.getContext("2d");

      class Particle {
        constructor(x, y, color, velocity) {
          this.x = x;
          this.y = y;
          this.color = color;
          this.radius = Math.random() * 2 + 1;
          this.velocity = velocity;
          this.life = 100;
          this.alpha = 1;
          this.shimmer = Math.random() < 0.3;
        }
        draw() {
          c.beginPath();
          c.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          let alpha = this.alpha;
          if (this.shimmer) { alpha *= 0.5 + Math.random() * 0.5; }
          c.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha})`;
          c.fill();
        }
        update() {
          this.x += this.velocity.x;
          this.y += this.velocity.y;
          this.velocity.y += 0.05;
          this.life--;
          this.alpha -= 0.01;
        }
      }

      class Firework {
        constructor(x, y, color, speed, parts) {
          this.x = x;
          this.y = canvas.height;
          this.targetX = x;
          this.targetY = y;
        //here
          this.color = (color)? color : {
            r: Math.floor(Math.random() * 255),
            g: Math.floor(Math.random() * 255),
            b: Math.floor(Math.random() * 255),
          };
        //====/
          const angle = (Math.random() * Math.PI) / 4 - Math.PI / 8;
        //here
          this.speed = (Math.random() * 3 + 5) * ((speed)? speed : 1); //default: 5-8
          this.velocity = { 
            x: Math.sin(angle) * this.speed,
            y: -Math.cos(angle) * this.speed,
          };
        //====/
          this.particles = [];
          this.trail = [];
          this.exploded = false;
          this.explosionProgress = 0;
          this.hasShimmer = Math.random() < 0.5;
        //here
          this.parts = parts;
        //====/
        }
        explode() {
        //here
          let n = (15 + Math.random() * 50) * ((this.parts)? this.parts : 1);
        //====/
          for (let i = 0; i < n; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 3 + 1;
            const velocity = { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed, };
            this.particles.push( new Particle(this.x, this.y, this.color, velocity) );
          }
          this.exploded = true;
        }
        update() {
          if (!this.exploded) {
            this.x += this.velocity.x;
            this.y += this.velocity.y;
            //
            this.velocity.y += 0.02; //0.05;
            //
            this.trail.push( new Particle(this.x, this.y, this.color, {x:0, y:0}) );
            if (this.trail.length > 20) this.trail.shift();
            if (this.velocity.y >= 0 || this.y <= this.targetY) this.explode();
          } else {
            this.explosionProgress += 0.02;
            this.particles.forEach( (particle) => {particle.update(); particle.draw();} );
            this.particles = this.particles.filter( (particle) => particle.life > 0 );
          }
          this.trail.forEach( (particle, index) => {
            particle.alpha = (index / this.trail.length) * (1 - this.explosionProgress);
            if (this.hasShimmer) { particle.shimmer = true; }
            particle.draw();
          });
        }
        draw() {
          if (!this.exploded) {
            c.beginPath();
            c.arc(this.x, this.y, 2, 0, Math.PI * 2);
            c.fillStyle = `rgb(${this.color.r}, ${this.color.g}, ${this.color.b})`;
            c.fill();
          }
        }
      }

      let to_color = {
        yellow:     {r:255, g:253, b:  1},
        green:      {r:157, g:255, b:  0},
        cyan:       {r:  0, g:255, b:255},
        blue:       {r:  1, g:101, b:252},
        pink:       {r:254, g:  1, b:177},
        orange:     {r:255, g: 91, b:  0},
        random:     undefined,
      };
      let to_speed = {
        very_slow:  0.25,
        slow:       0.5,
        normal:     1,
        fast:       2,
        very_fast:  3,
      };
      let to_parts = {
        few:        0.5,
        normal:     1,
        much:       5,
        huge:       10,
        atomic:     50,
      };
      let from_setts = {
        color: "cyan",
        speed: "normal",
        parts: "atomic",
        tperf: 1,
        f_max: 50,
        e_msg: true,
      };
      let from_event = {
        amount: 1, //tokens
        username: "username",
      }
      
      let fireworks = [];
      let fws = Math.round(from_event.amount / from_setts.tperf); //fireworks
      let msg = from_event.amount + "(" + fws + ")" + " tokens from " + from_event.username;

      function animate() {
        c.clearRect(0, 0, canvas.width, canvas.height);
        if (from_setts.e_msg) {
          c.font = "12px Tahoma";
          c.textAlign = "center";   
          c.fillText(msg, canvas.width / 2, canvas.height - 10);
        }
        fireworks.forEach((firework) => {firework.update(); firework.draw();});
        if (fws > 0 && Math.random() < 0.05) {
          const x = Math.random() * canvas.width;
          const y = (Math.random() * canvas.height) / 2;
          fireworks.push( new Firework(
              x,
              y,
              to_color[from_setts.color],
              to_speed[from_setts.speed],
              to_parts[from_setts.parts])
          );
          fws--;
        }
        fireworks = fireworks.filter(
          (firework) => !firework.exploded || firework.particles.length > 0
        );
        requestAnimationFrame(animate);
      }
        
      if (fws > 0) animate();

    </script>
  </body>
</html>
